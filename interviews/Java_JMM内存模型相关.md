### JMM内存模型

##### `JMM`大致描述:

* `JMM`描述线程如何与内存交互, java虚拟机规范视图定义一种java内存模型, 来屏蔽各种操作系统内存访问的差异, 以实现java程序在各种平台都能达到一致的访问效果.
* `JMM`描述了`JVM`如何与计算机的内存进行交互
* `JMM`都是围绕着**原子性**,**有序性**,**可见性**进行展开的.

`JMM`的主要目标是定义程序中各个变量的访问规则, 虚拟机将变量存储到内存和从内存取出变量这样的底层细节.此处的变量存储指在堆内存中的变量.



#### 多线程的时候为什么容易出错

`java`内存模型规定所有的共享变量都存储在主内存中, 而每条线程都有自己的工作内存(本地内存), 工作内存保存了主内存共享变量的副本,而不同的内存又无法访问对方的工作内存, 所以如果线程在工作内存中修改了变量副本,其他线程无法得知. **线程的传值需要通过主内存完成**.

![](http://img.blog.csdn.net/20170306104808451?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2hvd2R5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

#### 主内存如何与工作内存交互

**java内存模型定义了8中操作来完成主内存与工作内存的交互细节,虚拟机必须保证这8中操作的每个操作都具有原子性**

* `lock`
* `unlock`
* `read`
* `load`
* `use`
* `assign`
* `store`
* `write`

